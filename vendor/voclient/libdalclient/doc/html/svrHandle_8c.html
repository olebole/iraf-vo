<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>DAL Client Library: svrHandle.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>svrHandle.c File Reference</h1>Utility methods to convert struct pointers to user handles.  
<a href="#_details">More...</a>
<p>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;unistd.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><b>svr_hContext_t</b></td></tr>

<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="9829f825c9f592d5ffe55d12c41ffb11"></a><!-- doxytag: member="svrHandle.c::MAX_CONTEXTS" ref="9829f825c9f592d5ffe55d12c41ffb11" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>MAX_CONTEXTS</b>&nbsp;&nbsp;&nbsp;256</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="23ed8e629c0a28eab14f92c888c8d7ef"></a><!-- doxytag: member="svrHandle.c::MAX_HANDLES" ref="23ed8e629c0a28eab14f92c888c8d7ef" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>MAX_HANDLES</b>&nbsp;&nbsp;&nbsp;4096</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="ae1d3cb4d6c4047f335409f0b025f06f"></a><!-- doxytag: member="svrHandle.c::SZ_HCNAME" ref="ae1d3cb4d6c4047f335409f0b025f06f" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>SZ_HCNAME</b>&nbsp;&nbsp;&nbsp;64</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="1aa4c4130283232a9b31c1a6655d0d18"></a><!-- doxytag: member="svrHandle.c::H_ENCODE" ref="1aa4c4130283232a9b31c1a6655d0d18" args="(c, i)" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>H_ENCODE</b>(c, i)&nbsp;&nbsp;&nbsp;(((i)&lt;&lt;8)|(c))</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="cd756a28f860cd31674897c8d8765daa"></a><!-- doxytag: member="svrHandle.c::H_CONTEXT" ref="cd756a28f860cd31674897c8d8765daa" args="(h)" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>H_CONTEXT</b>(h)&nbsp;&nbsp;&nbsp;((h)&amp;0x77)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="d39b5d04f102e1de901a692b565e7b40"></a><!-- doxytag: member="svrHandle.c::H_SLOT" ref="d39b5d04f102e1de901a692b565e7b40" args="(h)" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>H_SLOT</b>(h)&nbsp;&nbsp;&nbsp;((h)&gt;&gt;8)</td></tr>

<tr><td colspan="2"><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="5ad7d32f3a1ddabdc2933223ca6ce2ea"></a><!-- doxytag: member="svrHandle.c::handle_t" ref="5ad7d32f3a1ddabdc2933223ca6ce2ea" args="" -->
typedef int&nbsp;</td><td class="memItemRight" valign="bottom"><b>handle_t</b></td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="svrHandle_8c.html#2830c3a33d71f99aa5478ad468f8a747">svr_initHandles</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize the handles structure.  <a href="#2830c3a33d71f99aa5478ad468f8a747"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="svrHandle_8c.html#549848ab6efc99d8d41f6d64eaa16130">svr_newHandleContext</a> (char *name, int size)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get a new handle context.  <a href="#549848ab6efc99d8d41f6d64eaa16130"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="svrHandle_8c.html#63ae175ef0af630f86a3458de79c315f">svr_closeHandleContext</a> (int context)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Close a handle context.  <a href="#63ae175ef0af630f86a3458de79c315f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="076cb9fba9fcf38377d1c1b1047afd48"></a><!-- doxytag: member="svrHandle.c::svr_newHandle" ref="076cb9fba9fcf38377d1c1b1047afd48" args="(int context, void *ptr)" -->
handle_t&nbsp;</td><td class="memItemRight" valign="bottom"><b>svr_newHandle</b> (int context, void *ptr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="svrHandle_8c.html#2d745c019c35cb8c87a6b46f5d93722e">svr_freeHandle</a> (handle_t handle)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Free the handle for later re-use.  <a href="#2d745c019c35cb8c87a6b46f5d93722e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="svrHandle_8c.html#6fd0d3e0136d1be3fdcb6617ca2fdaca">svr_H2P</a> (handle_t handle)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert a handle to a pointer.  <a href="#6fd0d3e0136d1be3fdcb6617ca2fdaca"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="svrHandle_8c.html#d257115fe5578cfb71989229211c3d0b">svr_resetHandles</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reset the handles structure.  <a href="#d257115fe5578cfb71989229211c3d0b"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="b6d82fb2ff0e51a5ff13f2d5b75a1f7e"></a><!-- doxytag: member="svrHandle.c::svr_numHContexts" ref="b6d82fb2ff0e51a5ff13f2d5b75a1f7e" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>svr_numHContexts</b> = 0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="6093def4bdd0c2a51710e85f573b8770"></a><!-- doxytag: member="svrHandle.c::svr_HContextOverflow" ref="6093def4bdd0c2a51710e85f573b8770" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>svr_HContextOverflow</b> = 0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="85b8d297b4960bbc5af12d019a4c57a8"></a><!-- doxytag: member="svrHandle.c::svr_HContextPoolOverflow" ref="85b8d297b4960bbc5af12d019a4c57a8" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>svr_HContextPoolOverflow</b> = 0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="be2cf6948d096c2cbfc324a893b16ca6"></a><!-- doxytag: member="svrHandle.c::svrHContexts" ref="be2cf6948d096c2cbfc324a893b16ca6" args="[MAX_CONTEXTS]" -->
svr_hContext_t *&nbsp;</td><td class="memItemRight" valign="bottom"><b>svrHContexts</b> [MAX_CONTEXTS]</td></tr>

</table>
<hr><h2>Detailed Description</h2>
Utility methods to convert struct pointers to user handles. 
<p>
SVRHANDLE.C -- Utility methods to convert struct pointers to user handles.<p>
<dl class="author" compact><dt><b>Authors:</b></dt><dd>Mike Fitzpatrick, Doug Tody </dd></dl>
<dl class="date" compact><dt><b>Date:</b></dt><dd>January 2014</dd></dl>
This version has been modified to avoid having a single large (eg 8192 element) array of service handles. In particular, if freeHandle deletes a handle and shifts the remaining elements of the array left, then (aside from the obvious inefficiency issue) index values change and the array[index] -&gt; ptr relationship is no longer valid.<p>
This could be fixed by replacing the simple index array with a hash table as in the Java version, however it would be nice to have a simpler scheme. The scheme provided here is instead context or subsystem-oriented. When a module is initialized, opens a connection, or initiates some other module-defined context, it opens a new context with svrHandle. Resource handles are then handed out sequentially within the connection context. If subsequently freed, the slot is merely left unused. When subsequently the connection context is freed, all resource handles created within that context are destroyed, and the connection number within svrHandle is available for re-use. Since connections are associated with dynamic activity this should make it much less likely to run out of space. (In DALClient for example, each connection to a remote service is the basis for all subsequent activity, and all resource handles created during execution are invalid anyway after closing the service connection).<p>
svr_initHandles () svr_resetHandles () hcon = svr_newHandleContext (contextName, size) svr_closeHandleContext (hcon) handle = svr_newHandle (hcon, ptr) svr_freeHandle (handle) ptr = svr_H2P (handle)<p>
We still have a simple global space of integer resource handles at the top level. Each integer handle consists of a connection number plus a resource number (array index within the connection context) packed as a single integer. [The P2H routine was omitted above as it is hard to see where this would be needed in well-designed class code where we are already operating in the space where we have resource pointers]. D.Tody January 2014 <hr><h2>Function Documentation</h2>
<a class="anchor" name="63ae175ef0af630f86a3458de79c315f"></a><!-- doxytag: member="svrHandle.c::svr_closeHandleContext" ref="63ae175ef0af630f86a3458de79c315f" args="(int context)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void svr_closeHandleContext           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>context</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Close a handle context. 
<p>
SVR_CLOSEHANDLECONTEXT -- Close a handle context.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>context</em>&nbsp;</td><td>Handle context</td></tr>
  </table>
</dl>
Any pointers to external objects are simply deleted. It is up to the caller to manage any external objects. 
</div>
</div><p>
<a class="anchor" name="2d745c019c35cb8c87a6b46f5d93722e"></a><!-- doxytag: member="svrHandle.c::svr_freeHandle" ref="2d745c019c35cb8c87a6b46f5d93722e" args="(handle_t handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void svr_freeHandle           </td>
          <td>(</td>
          <td class="paramtype">handle_t&nbsp;</td>
          <td class="paramname"> <em>handle</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Free the handle for later re-use. 
<p>
SVR_FREEHANDLE -- Free the handle for later re-use.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>handle</em>&nbsp;</td><td>object handle </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>nothing</dd></dl>
In this implementation we don't actually re-use a handle unless it is at the end of the list, but we mark all freed handles as NULL in any case so that the handle index remains valid. 
</div>
</div><p>
<a class="anchor" name="6fd0d3e0136d1be3fdcb6617ca2fdaca"></a><!-- doxytag: member="svrHandle.c::svr_H2P" ref="6fd0d3e0136d1be3fdcb6617ca2fdaca" args="(handle_t handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void * svr_H2P           </td>
          <td>(</td>
          <td class="paramtype">handle_t&nbsp;</td>
          <td class="paramname"> <em>handle</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Convert a handle to a pointer. 
<p>
SVR_H2P -- Convert a handle to a pointer<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>handle</em>&nbsp;</td><td>object handle </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>pointer to object or NULL </dd></dl>

</div>
</div><p>
<a class="anchor" name="2830c3a33d71f99aa5478ad468f8a747"></a><!-- doxytag: member="svrHandle.c::svr_initHandles" ref="2830c3a33d71f99aa5478ad468f8a747" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void svr_initHandles           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initialize the handles structure. 
<p>
SVR_INITHANDLES -- Initialize the handles structure.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>nothing </dd></dl>

</div>
</div><p>
<a class="anchor" name="549848ab6efc99d8d41f6d64eaa16130"></a><!-- doxytag: member="svrHandle.c::svr_newHandleContext" ref="549848ab6efc99d8d41f6d64eaa16130" args="(char *name, int size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int svr_newHandleContext           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Get a new handle context. 
<p>
SVR_NEWHANDLECONTEXT -- Get a new handle context.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>Context name (informational only) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>Max number of handles (not currently implemented) </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Context number allocated</dd></dl>
The size argument is not currently implemented and should be set to zero, which would cause a context to be created with the default size.<p>
A context number is a small integer, e.g., like a file descriptor. The handle mechanism permits only a limited number of simultaneously active handler contexts (no need to make it more complex than that). 
</div>
</div><p>
<a class="anchor" name="d257115fe5578cfb71989229211c3d0b"></a><!-- doxytag: member="svrHandle.c::svr_resetHandles" ref="d257115fe5578cfb71989229211c3d0b" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void svr_resetHandles           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Reset the handles structure. 
<p>
SVR_RESETANDLES -- Reset the handles structure.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>nothing</dd></dl>
The handles structure is reset to its initial state, freeing all resources (for example when closing down the module). 
</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Tue Sep 23 09:21:35 2014 for DAL Client Library by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.9 </small></address>
</body>
</html>
